local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

local RE = ReplicatedStorage:WaitForChild("RE")
local ClearEvent = RE:FindFirstChild("1Clea1rTool1s")
local ToolEvent = RE:FindFirstChild("1Too1l")
local FireEvent = RE:FindFirstChild("1Gu1n")

-- تنظيف الأدوات
local function clearAllTools()
	if ClearEvent then
		ClearEvent:FireServer("ClearAllTools")
	end
end

-- طلب السلاح
local function getAssault()
	if ToolEvent then
		ToolEvent:InvokeServer("PickingTools", "Assault")
	end
end

-- التحقق من وجود السلاح
local function hasAssault()
	return Player.Backpack:FindFirstChild("Assault") ~= nil
end

-- إطلاق النار على جزء معين
local function fireAtPart(targetPart)
	local gunScript = Player.Backpack:FindFirstChild("Assault")
		and Player.Backpack.Assault:FindFirstChild("GunScript_Local")

	if not gunScript or not targetPart then return end

	local args = {
		targetPart,
		targetPart,
		Vector3.new(1e14, 1e14, 1e14),
		targetPart.Position,
		gunScript:FindFirstChild("MuzzleEffect"),
		gunScript:FindFirstChild("HitEffect"),
		0,
		0,
		{ false },
		{
			25,
			Vector3.new(100, 100, 100),
			BrickColor.new(29),
			0.25,
			Enum.Material.SmoothPlastic,
			0.25
		},
		true,
		false
	}

	FireEvent:FireServer(unpack(args))
end

-- تجهيز السلاح في البداية
task.spawn(function()
	while true do
		clearAllTools()
		getAssault()
		repeat task.wait(0.2) until hasAssault()
		break
	end
end)

-- عند الضغط بزر الماوس الأيسر على لاعب، يطلق عليه النار
Mouse.Button1Down:Connect(function()
	local target = Mouse.Target
	if target then
		local model = target:FindFirstAncestorOfClass("Model")
		if model and Players:GetPlayerFromCharacter(model) and model:FindFirstChild("HumanoidRootPart") then
			for i = 1, 3 do
				fireAtPart(model.HumanoidRootPart)
				task.wait(0.1)
			end
		end
	end
end)
